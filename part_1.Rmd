---
title: "Project part 1"
output: html_document
date: "2022-08-24"
---
### Load Packages
```{r}
library(here)
library(tidyverse)
library(lubridate)
```


### Read in Data
```{r}

## Data lives only on taylor server - need absolute file path to access

## reading in our data - NAs are stored as '-999'
BQ1 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca1-Bisley.csv", na = "-9999")
BQ2 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca2-Bisley.csv", na = "-9999")
BQ3 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca3-Bisley.csv", na = "-9999")
PRM <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/RioMameyesPuenteRoto.csv", na = "-9999")




#fixing the date columns separately since formatting isnt consistent
bq2 <- BQ2 %>% 
  mutate(Sample_Date = as.Date(mdy_hm(Sample_Date)))
bq1 <- BQ1 %>% 
  mutate(Sample_Date = mdy(Sample_Date))
bq3 <- BQ3 %>% 
  mutate(Sample_Date = mdy(Sample_Date))
prm <- PRM %>% 
  mutate(Sample_Date = mdy(Sample_Date))


```



```{r}

## Combine into one dataframe
large_df <- rbind(bq1, bq2, bq3, prm)
```



```{r}
#subsetting to make our first plot

large_subset <- large_df %>% 
  select(Sample_ID, Sample_Date, NO3, K) %>%          #selecting pertinent columns and renaming by index
  rename(id = 1, date = 2, no3 = 3, k = 4) %>% 
  mutate(year = year(date)) %>%                       #extracting the year from the date column
  filter(year >= 1988 & year <= 1994) %>%             #filtering for years of interest                  
  mutate(my = floor_date(date, unit = "month")) %>%   #using floor_date to round each date to the nearest month
  group_by(id, my) %>%                                #grouping each site by month
  summarise(mean_k = mean(k, na.rm = TRUE))           #summarising to get the average K value per month
  

ggplot(large_subset, aes(x = my, y = mean_k)) + 
  geom_line(aes(color = id)) + 
  theme(aspect.ratio = 1/3) + 
  labs(x = "Year", 
       y = 'K (mg/l)') 

#+ facet_grid(no3 ~., scale = "free_y")
       
```

