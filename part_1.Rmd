---
title: "Project part 1"
output: html_document
date: "2022-08-24"
---
### Load Packages
```{r}
library(here)
library(tidyverse)
library(lubridate)
library(patchwork)
```


### Read in Data
```{r}

## Data lives only on taylor server - need absolute file path to access

## reading in our data - NAs are stored as '-999'
BQ1 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca1-Bisley.csv", na = "-9999")
BQ2 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca2-Bisley.csv", na = "-9999")
BQ3 <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/QuebradaCuenca3-Bisley.csv", na = "-9999")
PRM <- read_csv("/courses/EDS214/killer_whales/data/raw_data/csv/RioMameyesPuenteRoto.csv", na = "-9999")




#fixing the date columns separately since formatting isnt consistent
bq2 <- BQ2 %>% 
  mutate(Sample_Date = as.Date(mdy_hm(Sample_Date)))
bq1 <- BQ1 %>% 
  mutate(Sample_Date = mdy(Sample_Date))
bq3 <- BQ3 %>% 
  mutate(Sample_Date = mdy(Sample_Date))
prm <- PRM %>% 
  mutate(Sample_Date = mdy(Sample_Date))


```



```{r}

## Combine into one dataframe
large_df <- rbind(bq1, bq2, bq3, prm)
```



```{r}
#subsetting to make our first plot

large_subset <- large_df %>% 
  select(Sample_ID, Sample_Date, NO3, K) %>%          #selecting pertinent columns and renaming by index
  rename(id = 1, date = 2, no3 = 3, k = 4) %>% 
  mutate(year = year(date)) %>%                       
  filter(year >= 1988 & year <= 1994) %>%                              
  mutate(my = floor_date(date, unit = "month")) %>%   
  group_by(id, my) %>%
  summarise(mean_k = mean(k, na.rm = TRUE), 
            mean_no3 = mean(no3, na.rm = TRUE))           
  

k_plot <- ggplot(large_subset, aes(x = my, y = mean_k)) + 
  geom_line(aes(color = id)) + 
  theme(aspect.ratio = 1/3,
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank()) + 
  theme_minimal() +
  labs(x = "Year", 
       y = 'K (mg/l)') + scale_x_date(position = "top") + 
  geom_vline(xintercept = as.numeric(large_subset$my[5]) , linetype = "dotdash") 
       
```

### Plotting for nitrate

```{r}
  

no3_plot <- ggplot(large_subset, aes(x = my, y = mean_no3)) + 
  geom_line(aes(color = id), show.legend = FALSE) + 
  theme(aspect.ratio = 1/3) + 
  theme_minimal() + 
  labs(x = "Year", 
       y = 'NO3 (ug/L)') + theme(axis.text.x = element_blank(),
                                 axis.title.x = element_blank(),
                                 axis.ticks.x = element_blank(),
                                 panel.grid.minor.x = element_blank(),
                                 panel.grid.minor.y = element_blank()) +
  geom_vline(xintercept = as.numeric(large_subset$my[5]) , linetype = "dotdash") 
```


###Combining the plots

```{r}
big_plot <- (k_plot/no3_plot)
big_plot
```

